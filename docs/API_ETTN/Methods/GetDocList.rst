##########################################################################################################################
**Отримання списку документів сервісу "ЕТТН"**
##########################################################################################################################

Для роботи з цим методом користувач повинен бути `авторизованим <https://wiki.edi-n.com/uk/latest/API_ETTN/Methods/Authorization.html>`__ .

+--------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------+
|                       **Метод запиту**                       |                                                    **HTTP POST**                                                   |
+==============================================================+====================================================================================================================+
| **Content-Type**                                             | application/json (тіло запиту/відповіді в json форматі)                                                            |
+--------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------+
| **URL запиту**                                               | `{url серверу} <https://wiki.edi-n.com/uk/latest/API_ETTN/API_ETTN_list.html#url>`__ **/api/ettn/eds/docs/search** |
+--------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------+
| **Параметри, що передаються в URL (разом з адресою методу)** | В рядку заголовка (Header) "Set-Cookie" обов'язково передається **SID** - токен, отриманий при авторизації         |
|                                                              |                                                                                                                    |
|                                                              | **Обов'язкові url-параметри:**                                                                                     |
|                                                              |                                                                                                                    |
|                                                              | **company_uuid** - ідентифікатор компанії                                                                          |
+--------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------+

**JSON-параметри в тілі HTTP запиту/відповіді**
*******************************************************************

``REQUEST``

В цьому методі в json-тілі **запиту** передаються дані для фільтрації (об’єкт **StorageQuery**) 

.. _Таблиця_2:

Таблиця 2 - Опис json-параметрів (фільтр) **запиту** методу API

.. csv-table:: 
  :file: for_csv/StorageQuery.csv
  :widths:  1, 7, 12, 41
  :header-rows: 1
  :stub-columns: 0

Таблиця 3 - Опис параметрів об'єкта **ExtraQueryParameters**

.. csv-table:: 
  :file: for_csv/ExtraQueryParameters.csv
  :widths:  1, 7, 12, 41
  :header-rows: 1
  :stub-columns: 0

Таблиця 4 - Опис параметрів об'єкта **Direction**

.. csv-table:: 
  :file: for_csv/Direction.csv
  :widths:  1, 7, 12, 41
  :header-rows: 1
  :stub-columns: 0

Таблиця 5 - Опис параметрів об'єкта **Limitation**

.. csv-table:: 
  :file: for_csv/Limitation.csv
  :widths:  1, 7, 12, 41
  :header-rows: 1
  :stub-columns: 0

Таблиця 6 - Опис параметрів об'єкта **DateTimeRange**

.. csv-table:: 
  :file: for_csv/DateTimeRange.csv
  :widths:  1, 7, 12, 41
  :header-rows: 1
  :stub-columns: 0

Таблиця 7 - Опис параметрів об'єкта **XDocType**

.. csv-table:: 
  :file: for_csv/XDocType.csv
  :widths:  1, 7, 12, 41
  :header-rows: 1
  :stub-columns: 0

.. _fieldName:

Таблиця 8 - Опис **fieldName** параметрів (объект ExtraQueryParameters_)

.. csv-table:: 
  :file: for_csv/extra_fields.csv
  :widths:  1, 2, 7, 12, 41
  :header-rows: 1
  :stub-columns: 0

.. _опис_параметрів:

Таблиця 9 - Опис **DocType** параметрів (объект XDocType_)

.. csv-table:: 
  :file: for_csv/xdoctype_p.csv
  :widths:  1, 19, 41
  :header-rows: 1
  :stub-columns: 0

``RESPONSE``

У **відповідь** передається масив документів (об'єкт `XDoc <https://wiki.edi-n.com/uk/latest/API_ETTN/Methods/XDocPage.html>`__ ).

--------------

**Приклади**
*****************

Отримати всі документи окрім чернеток(масив statuses не містить "1"), в яких отримувачем є GLN 9864232304302 
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

.. code:: ruby

    {
        "direction": {
            "sender": [],
            "receiver": ["9864232304302"],
            "type": "EQ"
        },
        "exchangeStatus": [],
        "family": "1",
        "statuses": ["2","3","4","5","6","7"],
        "type": [
            {
                "type": "0"
            }
        ]
    }

Отримати всі документи окрім чернеток(масив statuses не містить "1"), в яких відправником є GLN 9864232304302 
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

.. code:: ruby

    {
        "direction": {
            "sender": ["9864232304302"],
            "receiver": [],
            "type": "EQ"
        },
        "exchangeStatus": [],
        "family": "1",
        "statuses": ["2","3","4","5","6","7"],
        "type": [
            {
                "type": "0"
            }
        ]
    }

Отримати всі вхідні документи (GLN отримувача 9864232304302) 
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

.. code:: ruby

    {
        "direction": {
            "sender": [],
            "receiver": ["9864232304302"],
            "type": "EQ"
        },
        "exchangeStatus": [],
        "family": "1",
        "statuses": ["4","5","6"],
        "type": [
            {
                "type": "0"
            }
        ]
    }

Отримати всі відправлені документи (GLN відправника 9864232304302) 
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

.. code:: ruby

    {
        "direction": {
            "sender": ["9864232304302"],
            "receiver": [],
            "type": "EQ"
        },
        "exchangeStatus": [],
        "family": "1",
        "statuses": ["2","3","6"],
        "type": [
            {
                "type": "0"
            }
        ]
    }

Отримати документи з номером рівним значенню "1001" (пошук серед усіх документів окрім чернеток), в яких отримувачем є GLN 9864232304302
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

.. code:: ruby

    {
        "direction": {
            "sender": [],
            "receiver": ["9864232304302"],
            "type": "EQ"
        },
        "exchangeStatus": [],
        "family": "1",
        "statuses": ["2","3","4","5","6","7"],
        "number": "1001",
        "type": [
            {
                "type": "0"
            }
        ]
    }

Отримати всі документи окрім чернеток для GLN відправника 9864232304302, що створені в травні 2019 (startTimestamp і finishTimestamp дати в форматі UNIX-timestamp)
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

.. code:: ruby

    {
        "direction": {
            "sender": ["9864232304302"],
            "receiver": [],
            "type": "EQ"
        },
        "exchangeStatus": [],
        "family": "1",
        "statuses": ["2","3","4","5","6","7"],
        "type": [
            {
                "type": "0"
            }
        ],
        "docDate": {
            "startTimestamp": "1556668800",
            "finishTimestamp": "1559347199"
        }
    }

--------------

**Приклад тіла відповіді (json):**

.. code:: ruby

    {
        "items": [
            {
                "body": {
                    "forms": {}
                },
                "attachments": [],
                "comments": [],
                "doc_id": 1017,
                "doc_uuid": "e18a05d5-983b-4ebc-95f3-c35eccc7d611",
                "uuidSender": "4820128010004",
                "uuidReceiver": "9864065702429",
                "docNumber": "8663c3f48bea4f96a281238e847b1639",
                "dateCreated": 1549961913,
                "dateChanged": 1549961913,
                "dateRead": 0,
                "docDate": 1547503200,
                "chain_id": 1006,
                "chain_uuid": "60e487d3-871f-4b3a-9254-1d3f0e7a032f",
                "family": 1,
                "hash": "30745386780343D0C2F4C65C7F06D60F",
                "type": {
                    "type": 1,
                    "title": "invoice",
                    "description": "Счет"
                },
                "status": {
                    "status": 4,
                    "title": "inbox"
                },
                "exchange_status": "000000000000000000000000",
                "is_archive": false,
                "extraFields": {
                    "order_date": "1551477600",
                    "delivery_date": "1547503200",
                    "ftpex_file_name": "highload_invoice_test.xml",
                    "sender": "4820128010004",
                    "buyer_uuid": "4820128010004",
                    "doc_num": "8663c3f48bea4f96a281238e847b1639",
                    "order_number": "747401",
                    "doc_date": "1547503200",
                    "recipient": "9864065702429",
                    "ftpex_file_date": "1549961913",
                    "supplier_uuid": "9864065702429",
                    "delivery_place_uuid": "4820128019007"
                },
                "tags": [],
                "statuses": [],
                "multiExtraFields": {}
            }
        ],
        "totalCount": 0
    } 



